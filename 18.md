# NIP-18

## Private Direct Message

`draft` `optional` `author:giszmo`

A special event with kind `4`, meaning "private direct message". It improves on
[nip-04](04.md) by not revealing the recipient of direct messages. The event
format is equal to nip-04, with the following changes:

**`tags`** MAY contain entries identifying potential receivers of the message in
the form `["p", "<pubkey, as a hex string>"]`.

**`tags`** SHOULD NOT contain further identifying information.

## Sending DM

The sender may add a tag identifying the recipient on the first message of a
conversation if the other party does not publicly follow them according to their
`kind 0` event or let them know out of bands to check their DM.

## Receiving DM

Clients should query for all relevant `kind 4` events. In the beginning, this
might be simply all `{"kinds":[4]}` and later only those from follows.

Clients should query `{"kinds":[4],"#p":["<pubkey, as a hex string>"]:}`.

Clients should try to decrypt all these events regardless of their receiver tag
or absence thereof.

## Privacy Analysis

### Events

Users still leak being active via attributable events but timing analysis
becomes harder as soon as several chats happen at once.

### Relays

Relays knowing who is interested in which event have an advantage at learning
who is chatting. Therefore clients should query non-follows for example using
different identities, via TOR or similar.
