# NIP-18

## Private Direct Message

`draft` `optional` `author:giszmo`

A special event with kind `4`, meaning "private direct message". It improves on
[nip-04](04.md) by not revealing the recipient of direct messages. The event
format is equal to nip-04, with the following changes:

**`tags`** MAY contain entries identifying potential receivers of the message in
the form `["p", "<pubkey, as a hex string>"]`.

**`tags`** SHOULD NOT contain further identifying information.

## Sending DM

The sender may add a tag identifying the recipient on the first message of a
conversation if the other party does not publicly follow them according to their
`kind 0` event or let them know out of bands to check their DM.

## Receiving DM

Clients should query for all relevant `kind 4` events. In the beginning, this
might be simply all `{"kinds":[4]}` and later only those from follows.

Clients should query `{"kinds":[4],"#p":["<pubkey, as a hex string>"]:}`.

Clients should try to decrypt all these events regardless of their receiver tag
or absence thereof.

## Privacy Analysis

### Events

Users still leak being active via attributable events but timing analysis
becomes harder as soon as several chats happen at once.

### Relays

Relays knowing who is interested in which event have an advantage at learning
who is chatting. Therefore clients should query non-follows for example using
different identities, via TOR or similar.

## Example

```
privAlice:         aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
pubAlice:          6a04ab98d9e4774ad806e302dddeb63bea16b5cb5f223ee77478e861bb583eb3
privBob:           bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb
pubBob:            68680737c76dabb801cb2204f57dbe4e4579e4f710cd67dc1b4227592c81e9b5
privCarol:         cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
pubCarol:          b95c249d84f417e3e395a127425428b540671cc15881eb828c17b722a53fc599

sharedSecretAB:    1d3e7279da3f845c4246087cdd3dd42bea3dea7245ceaf75609d8eb0a4e89c4e
msg:               "Hello World!"
event:             {
                      "id":         "6a356c24bbeb222e3c8cad01267c24c944b15ac006101fae6fcd5f0f1703d1d2",
                      "pubkey":     "6a04ab98d9e4774ad806e302dddeb63bea16b5cb5f223ee77478e861bb583eb3",
                      "created_at": 1657496503,
                      "kind":       4,
                      "tags":       [["p","b95c249d84f417e3e395a127425428b540671cc15881eb828c17b722a53fc599"]],
                      "content":    "dOxNt225pDnmJ1t0DgOU7w==?iv=vWSVad5CXjXU1RSVkhG5QA==",
                      "sig":        "952c519a0ebc2f049cabafcacd0bdac036a254469b98a420da9afbeccd797fc5ec9a60bec4e317d3a64810b91bb86f0cfc97555424ab5fa3774e0c8d02fefcf1"
                   }
bobGetsContent:    "Hello World!"
carolGetsContent:  Error
```
